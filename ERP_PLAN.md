# План разработки ERP системы для управления коммерческой недвижимостью

## 1. Анализ требований

### 1.1 Бизнес-требования
- **Владелец**: Управление несколькими коммерческими объектами
- **Объекты**: Каждый объект содержит множество юнитов (помещений)
- **Юниты**: Сдаются в аренду с отслеживанием:
  - Стоимость за квадратный метр
  - Площадь юнита
  - Обязательные платежи (коммунальные, налоги, обслуживание)
  - Текущий арендатор (имя/название компании)
- **Цель**: Простой интерфейс для анализа доходности и статуса бизнеса

### 1.2 Функциональные требования
- Управление объектами недвижимости
- Управление юнитами в каждом объекте
- Учет арендаторов и договоров аренды
- Расчет доходности по каждому юниту и объекту
- Управленческий учет (доходы, расходы, прибыль)
- Аналитика и отчетность
- Дашборд с ключевыми показателями

### 1.3 Нефункциональные требования
- Простой и интуитивный интерфейс
- Быстрый доступ к ключевым метрикам
- Визуализация данных (графики, диаграммы)
- Мобильная адаптивность
- Безопасность данных

---

## 2. Архитектура системы

### 2.1 Технологический стек

**Frontend:**
- HTML5, CSS3, JavaScript (ES6+)
- React или Vue.js (для динамического интерфейса)
- Chart.js или D3.js (для графиков и визуализации)
- Material-UI или Tailwind CSS (для UI компонентов)

**Backend:**
- Node.js + Express или Python + Flask/FastAPI
- RESTful API для взаимодействия с фронтендом

**База данных:**
- PostgreSQL или MySQL (реляционная БД)
- Альтернатива: SQLite (для MVP версии)

**Хранение данных:**
- Локальное хранилище (для MVP)
- Облачное хранилище (для production)

### 2.2 Структура проекта
```
erp-system/
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   ├── pages/
│   │   ├── services/
│   │   ├── utils/
│   │   └── styles/
│   └── public/
├── backend/
│   ├── routes/
│   ├── models/
│   ├── controllers/
│   ├── middleware/
│   └── config/
├── database/
│   └── migrations/
└── docs/
```

---

## 3. Модель данных

### 3.1 Сущности и их связи

#### **Объект (Property)**
- `id` - уникальный идентификатор
- `name` - название объекта
- `address` - адрес
- `total_area` - общая площадь объекта
- `created_at` - дата создания
- `updated_at` - дата обновления

#### **Юнит (Unit)**
- `id` - уникальный идентификатор
- `property_id` - связь с объектом (FK)
- `unit_number` - номер юнита
- `area` - площадь юнита (м²)
- `price_per_sqm` - стоимость за м²
- `status` - статус (свободен/арендован/на ремонте)
- `monthly_rent` - месячная арендная плата (рассчитывается: area × price_per_sqm)
- `current_tenant_id` - связь с текущим арендатором (FK, nullable, связь через активный договор)
- `current_tenant_name` - имя текущего арендатора (вычисляемое поле или кэш для быстрого доступа)
- `current_lease_id` - связь с активным договором аренды (FK, nullable)
- `created_at` - дата создания
- `updated_at` - дата обновления

#### **Арендатор (Tenant)**
- `id` - уникальный идентификатор
- `name` - название компании/ФИО
- `contact_person` - контактное лицо
- `phone` - телефон
- `email` - email
- `tax_id` - ИНН (для юридических лиц)
- `created_at` - дата создания

#### **Договор аренды (Lease)**
- `id` - уникальный идентификатор
- `unit_id` - связь с юнитом (FK)
- `tenant_id` - связь с арендатором (FK)
- `start_date` - дата начала аренды
- `end_date` - дата окончания аренды
- `monthly_rent` - месячная арендная плата
- `deposit` - залог
- `status` - статус (активен/завершен/расторгнут)
- `created_at` - дата создания

**Примечание:** При создании активного договора аренды система автоматически обновляет поля `current_tenant_id`, `current_tenant_name` и `current_lease_id` в соответствующем юните. При завершении или расторжении договора эти поля обнуляются, а статус юнита меняется на "свободен".

#### **Обязательные платежи (MandatoryPayment)**
- `id` - уникальный идентификатор
- `unit_id` - связь с юнитом (FK)
- `property_id` - связь с объектом (FK, для общих платежей)
- `payment_type` - тип платежа (коммунальные/налоги/обслуживание/другое)
- `amount` - сумма платежа (плановое значение)
- `frequency` - частота (ежемесячно/ежеквартально/ежегодно)
- `start_date` - дата начала действия
- `end_date` - дата окончания (null если бессрочно)
- `is_cost` - флаг себестоимости (true - обязательный платеж как себестоимость)
- `created_at` - дата создания

**Примечание:** Обязательные платежи с `is_cost = true` автоматически генерируются каждый месяц в период с 1 по 30 число как себестоимость юнита/объекта.

#### **Фактические обязательные платежи (ActualMandatoryPayment)**
- `id` - уникальный идентификатор
- `mandatory_payment_id` - связь с плановым обязательным платежом (FK)
- `unit_id` - связь с юнитом (FK)
- `property_id` - связь с объектом (FK)
- `payment_type` - тип платежа
- `planned_amount` - плановая сумма (из MandatoryPayment)
- `actual_amount` - фактически оплаченная сумма
- `payment_date` - дата фактической оплаты (в период с 1 по 30 число месяца)
- `month` - месяц платежа (1-12)
- `year` - год платежа
- `status` - статус (планируется/оплачено/просрочено)
- `is_paid` - флаг оплаты (true/false)
- `created_at` - дата создания
- `updated_at` - дата обновления

**Примечание:** Каждый месяц система автоматически создает записи фактических платежей на основе плановых обязательных платежей. Пользователь может вносить фактические суммы оплаты в период с 1 по 30 число каждого месяца.

#### **Фактические платежи от арендаторов (TenantPayment)**
- `id` - уникальный идентификатор
- `lease_id` - связь с договором аренды (FK)
- `unit_id` - связь с юнитом (FK)
- `tenant_id` - связь с арендатором (FK)
- `planned_amount` - плановая сумма арендной платы (из договора)
- `actual_amount` - фактически полученная сумма от арендатора
- `payment_date` - дата фактического получения платежа (в период с 1 по 30 число месяца)
- `month` - месяц платежа (1-12)
- `year` - год платежа
- `status` - статус (ожидается/получено/просрочено/частично оплачено)
- `is_paid` - флаг оплаты (true/false)
- `payment_method` - способ оплаты (наличные/безналичный/другое)
- `description` - описание/комментарий
- `created_at` - дата создания
- `updated_at` - дата обновления

**Примечание:** Система автоматически создает плановые записи платежей от арендаторов на основе активных договоров. Пользователь отмечает фактические платежи, полученные от арендаторов.

#### **Транзакции (Transaction)**
- `id` - уникальный идентификатор
- `unit_id` - связь с юнитом (FK)
- `lease_id` - связь с договором (FK)
- `type` - тип (доход/расход)
- `category` - категория
- `amount` - сумма
- `date` - дата транзакции
- `description` - описание
- `is_planned` - флаг плановой транзакции (true - плановая, false - фактическая)
- `related_payment_id` - связь с фактическим платежом (FK, для связи с TenantPayment или ActualMandatoryPayment)
- `created_at` - дата создания

**Примечание:** Транзакции могут быть плановыми (автоматически создаются на основе договоров и обязательных платежей) или фактическими (вносятся пользователем при получении/оплате).

---

## 4. Модули системы

### 4.1 Модуль управления объектами
**Функции:**
- Список всех объектов
- Добавление/редактирование/удаление объекта
- Просмотр общей информации об объекте
- Статистика по объекту (занятость, доходность)

**Интерфейс:**
- Таблица объектов с основными показателями
- Карточка объекта с детальной информацией
- Форма добавления/редактирования

### 4.2 Модуль управления юнитами
**Функции:**
- Список юнитов по объекту
- Добавление/редактирование/удаление юнита
- Установка цены за м²
- Расчет месячной арендной платы
- Управление статусом юнита
- Отображение имени текущего арендатора для каждого юнита
- Быстрый переход к информации об арендаторе

**Интерфейс:**
- Таблица юнитов с фильтрацией по объекту
  - Отображение имени арендатора для каждого юнита
  - Колонка "Арендатор" с именем текущего арендатора (или "Свободен" для незанятых юнитов)
- Карточка юнита с информацией об арендаторе
- Форма добавления/редактирования
- Индикатор статуса (цветовая маркировка)
- Ссылка на карточку арендатора (если юнит арендован)

### 4.3 Модуль управления арендаторами
**Функции:**
- Список арендаторов
- Добавление/редактирование/удаление арендатора
- История договоров арендатора
- Контактная информация

**Интерфейс:**
- Таблица арендаторов
- Карточка арендатора
- Форма добавления/редактирования

### 4.4 Модуль договоров аренды
**Функции:**
- Список активных договоров
- Создание нового договора
- Редактирование договора
- Расторжение договора
- Напоминания о продлении договоров
- Автоматическое создание плановых платежей от арендаторов каждый месяц
- Управление фактическими платежами от арендаторов

**Интерфейс:**
- Календарь договоров
- Таблица договоров с фильтрами
- Форма создания/редактирования договора
- Уведомления о приближающихся датах окончания
- Таблица плановых и фактических платежей от арендаторов
- Форма внесения фактических платежей от арендаторов (доступна с 1 по 30 число каждого месяца)
- Индикаторы статуса платежей (ожидается/получено/просрочено)

### 4.5 Модуль обязательных платежей
**Функции:**
- Управление плановыми обязательными платежами по юнитам
- Управление общими платежами по объектам
- Автоматическое создание фактических платежей каждый месяц (с 1 по 30 число)
- Внесение фактических сумм обязательных платежей
- Отметка оплаты обязательных платежей
- Управление платежами как себестоимостью (флаг `is_cost`)
- История плановых и фактических платежей
- Отслеживание просроченных платежей

**Интерфейс:**
- Таблица плановых обязательных платежей с группировкой
- Форма добавления/редактирования планового платежа
- Календарь фактических платежей по месяцам
- Форма внесения фактических платежей (доступна с 1 по 30 число каждого месяца)
- Индикаторы статуса платежей (планируется/оплачено/просрочено)
- Фильтры по месяцу, году, типу платежа, статусу
- Настройка автоматических платежей
- Отчет по расхождениям плановых и фактических сумм

### 4.6 Модуль финансового учета
**Функции:**
- Учет плановых и фактических доходов (арендная плата)
- Учет плановых и фактических расходов (обязательные платежи как себестоимость, ремонт, обслуживание)
- Расчет прибыли по юниту/объекту (на основе плановых и фактических данных)
- Расчет рентабельности
- Сравнение плановых и фактических показателей
- Учет себестоимости через обязательные платежи

**Интерфейс:**
- Таблица транзакций с разделением на плановые и фактические
- Форма добавления транзакции
- Фильтры по дате, типу, категории, статусу (план/факт)
- Переключение между плановыми и фактическими данными
- Сравнительная таблица плановых и фактических показателей
- Индикаторы отклонений фактических значений от плановых

### 4.7 Модуль аналитики и отчетности
**Функции:**
- Дашборд с ключевыми показателями:
  - Общая доходность портфеля (план/факт)
  - Доходность по объектам (план/факт)
  - Доходность по юнитам (план/факт)
  - Процент занятости
  - Средняя стоимость аренды за м²
  - Отклонения фактических показателей от плановых
  - Себестоимость через обязательные платежи
- Графики и диаграммы:
  - Динамика доходов/расходов (план vs факт)
  - Распределение доходов по объектам
  - Статус занятости юнитов
  - График отклонений плановых и фактических показателей
  - Анализ себестоимости по обязательным платежам
- Отчеты:
  - Отчет по объекту (план/факт)
  - Отчет по юниту (план/факт)
  - Финансовый отчет за период (план/факт)
  - Отчет по платежам от арендаторов
  - Отчет по обязательным платежам (себестоимость)
  - Отчет по отклонениям

**Интерфейс:**
- Главный дашборд с виджетами (переключение план/факт)
- Интерактивные графики с возможностью сравнения плановых и фактических данных
- Экспорт отчетов (PDF, Excel) с разделением на плановые и фактические данные

---

## 5. Интерфейс пользователя

### 5.1 Главная страница (Дашборд)
**Элементы:**
- Переключатель "План / Факт" для отображения плановых или фактических данных
- Карточки с ключевыми метриками:
  - Общая доходность (руб/мес) - план/факт
  - Количество объектов
  - Количество юнитов
  - Процент занятости
  - Средняя доходность за м² - план/факт
  - Отклонение фактических показателей от плановых
- График доходов за период (линейный график с линиями план/факт)
- Таблица топ-5 объектов по доходности (с отображением плановых и фактических значений)
- Календарь с важными датами:
  - Окончание договоров
  - Период внесения фактических платежей (1-30 число каждого месяца)
- Виджет "Требуют внимания":
  - Просроченные платежи от арендаторов
  - Неоплаченные обязательные платежи
  - Юниты с большими отклонениями фактических показателей от плановых
- Быстрые действия:
  - Добавить объект
  - Добавить юнит
  - Создать договор
  - Внести фактические платежи (активно с 1 по 30 число)

### 5.2 Навигация
**Меню:**
- Главная (Дашборд)
- Объекты
- Юниты
- Арендаторы
- Договоры
- Платежи
- Финансы
- Отчеты
- Настройки

### 5.3 Принципы дизайна
- Минималистичный и чистый интерфейс
- Цветовая индикация статусов:
  - Зеленый - активен/прибыльный
  - Желтый - внимание требуется
  - Красный - проблема/убыточный
  - Серый - неактивен
- Адаптивный дизайн для мобильных устройств
- Быстрый доступ к важной информации
- Визуализация данных (графики, диаграммы)

---

## 6. Этапы разработки

### Этап 1: MVP (Минимально жизнеспособный продукт) - 2-3 недели
**Цель:** Базовая функциональность для начала работы

**Задачи:**
1. Настройка проекта и структуры
2. Создание базы данных (основные таблицы)
3. Backend API (CRUD операции для основных сущностей)
4. Frontend:
   - Главная страница с базовым дашбордом
   - Управление объектами
   - Управление юнитами
   - Базовые расчеты доходности
5. Простая авторизация (опционально)

**Результат:** Рабочая система для учета объектов и юнитов с базовыми расчетами

### Этап 2: Расширенная функциональность - 2-3 недели
**Цель:** Полноценное управление арендой

**Задачи:**
1. Модуль арендаторов
2. Модуль договоров аренды
3. Модуль обязательных платежей:
   - Плановые обязательные платежи
   - Фактические обязательные платежи
   - Автоматическая генерация фактических платежей каждый месяц (с 1 по 30 число)
   - Отметка платежей как себестоимости (`is_cost`)
4. Модуль платежей от арендаторов:
   - Плановые платежи от арендаторов (автоматическая генерация)
   - Фактические платежи от арендаторов
   - Внесение фактических сумм в период с 1 по 30 число месяца
5. Финансовый учет (доходы/расходы) с разделением на плановые и фактические
6. Улучшенный дашборд с графиками (план/факт)
7. Базовые отчеты с сравнением плановых и фактических показателей

**Результат:** Полнофункциональная система управления арендой с учетом плановых и фактических платежей

### Этап 3: Аналитика и оптимизация - 1-2 недели
**Цель:** Глубокая аналитика и улучшение UX

**Задачи:**
1. Расширенная аналитика:
   - Детальные графики и диаграммы (план vs факт)
   - Сравнительный анализ объектов
   - Анализ отклонений плановых и фактических показателей
   - Прогнозирование доходности на основе исторических данных
   - Отчеты по себестоимости через обязательные платежи
2. Экспорт отчетов (PDF, Excel) с разделением на плановые и фактические данные
3. Уведомления и напоминания:
   - О необходимости внесения фактических платежей (с 1 по 30 число)
   - О просроченных платежах от арендаторов
   - О просроченных обязательных платежах
4. Автоматизация:
   - Автоматическая генерация плановых платежей в начале месяца
   - Напоминания о внесении фактических данных
5. Оптимизация производительности
6. Улучшение UI/UX с акцентом на удобство внесения фактических платежей

**Результат:** Профессиональная система с полной аналитикой и автоматизацией учета платежей

### Этап 4: Дополнительные функции - по необходимости
**Цель:** Расширение функциональности

**Возможные функции:**
- Мультипользовательский доступ с ролями
- Интеграция с банками (импорт транзакций)
- Мобильное приложение
- Документооборот (автоматическая генерация договоров)
- Учет ремонтов и обслуживания
- Планирование бюджета

---

## 7. Ключевые метрики и расчеты

### 7.1 Расчеты по юниту

**Плановые показатели:**
- **Плановая месячная арендная плата** = `area × price_per_sqm`
- **Плановые обязательные платежи за месяц** = сумма всех плановых обязательных платежей юнита (где `is_cost = true`)
- **Плановая чистая прибыль с юнита** = `плановая_арендная_плата - плановые_обязательные_платежи`
- **Плановая рентабельность юнита** = `(плановая_чистая_прибыль / плановая_арендная_плата) × 100%`

**Фактические показатели:**
- **Фактическая месячная арендная плата** = сумма фактических платежей от арендатора за месяц
- **Фактические обязательные платежи за месяц** = сумма фактически оплаченных обязательных платежей юнита
- **Фактическая чистая прибыль с юнита** = `фактическая_арендная_плата - фактические_обязательные_платежи`
- **Фактическая рентабельность юнита** = `(фактическая_чистая_прибыль / фактическая_арендная_плата) × 100%`

**Отклонения:**
- **Отклонение доходов** = `фактическая_арендная_плата - плановая_арендная_плата`
- **Отклонение расходов** = `фактические_обязательные_платежи - плановые_обязательные_платежи`
- **Отклонение прибыли** = `фактическая_прибыль - плановая_прибыль`

### 7.2 Расчеты по объекту
- **Общая доходность объекта** = сумма доходности всех юнитов объекта
- **Процент занятости** = `(арендованные_юниты / общее_количество_юнитов) × 100%`
- **Средняя стоимость аренды за м²** = `общая_арендная_плата / общая_площадь_арендованных_юнитов`

### 7.3 Общие метрики
- **Общая доходность портфеля** = сумма доходности всех объектов
- **Общая площадь** = сумма площадей всех объектов
- **Общее количество юнитов** = количество всех юнитов
- **Общий процент занятости** = средний процент занятости по всем объектам

---

## 8. Примеры использования

### Сценарий 1: Добавление нового объекта
1. Пользователь переходит в раздел "Объекты"
2. Нажимает "Добавить объект"
3. Заполняет форму: название, адрес, общая площадь
4. Сохраняет объект
5. Объект появляется в списке

### Сценарий 2: Добавление юнита и расчет доходности
1. Пользователь выбирает объект
2. Добавляет юнит: номер, площадь (например, 50 м²)
3. Устанавливает цену за м² (например, 1000 руб/м²)
4. Система автоматически рассчитывает плановую месячную арендную плату: 50 × 1000 = 50,000 руб/мес
5. Пользователь добавляет обязательные платежи как себестоимость (например, коммунальные: 5,000 руб/мес, отмечает `is_cost = true`)
6. Система показывает плановую чистую прибыль: 50,000 - 5,000 = 45,000 руб/мес

### Сценарий 2.2: Внесение фактических платежей
1. В начале месяца (с 1 по 30 число) система автоматически создает записи для фактических платежей:
   - Фактические платежи от арендаторов (на основе активных договоров)
   - Фактические обязательные платежи (на основе плановых обязательных платежей)
2. Пользователь вносит фактическую сумму арендной платы от арендатора (например, получил 48,000 руб вместо плановых 50,000 руб)
3. Пользователь вносит фактические обязательные платежи (например, коммунальные: 5,200 руб вместо плановых 5,000 руб)
4. Система рассчитывает фактическую прибыль: 48,000 - 5,200 = 42,800 руб
5. Система показывает отклонения: доходы -2,000 руб, расходы +200 руб, прибыль -2,200 руб

### Сценарий 2.1: Просмотр юнитов с арендаторами
1. Пользователь открывает список юнитов объекта
2. Видит таблицу с колонками: номер юнита, площадь, цена за м², арендная плата, **имя арендатора**, статус
3. Для арендованных юнитов отображается имя арендатора (например, "ООО 'Торговый дом'")
4. Для свободных юнитов в колонке арендатора отображается "Свободен"
5. Кликая на имя арендатора, пользователь переходит к карточке арендатора

### Сценарий 3: Анализ доходности
1. Пользователь открывает дашборд
2. Видит общую доходность портфеля (план/факт)
3. Переключается между плановыми и фактическими данными
4. Кликает на объект для детального просмотра
5. Видит график доходности за период с линиями план/факт
6. Сравнивает доходность разных объектов
7. Анализирует отклонения фактических показателей от плановых
8. Экспортирует отчет для анализа (с разделением на план/факт)

### Сценарий 4: Автоматическая генерация платежей
1. В первый день месяца (1 число) система автоматически:
   - Создает плановые записи платежей от арендаторов на основе активных договоров
   - Создает плановые записи фактических обязательных платежей на основе плановых обязательных платежей
   - Устанавливает статус "ожидается" или "планируется"
2. Пользователь получает уведомление о необходимости внесения фактических данных
3. В период с 1 по 30 число месяца пользователь может:
   - Вносить фактические суммы платежей от арендаторов
   - Вносить фактические суммы обязательных платежей
   - Отмечать платежи как оплаченные/полученные
4. Система автоматически пересчитывает показатели доходности на основе фактических данных

---

## 9. Технические детали

### 9.1 API Endpoints (примеры)

```
GET    /api/properties              - список объектов
POST   /api/properties              - создать объект
GET    /api/properties/:id          - получить объект
PUT    /api/properties/:id          - обновить объект
DELETE /api/properties/:id          - удалить объект

GET    /api/properties/:id/units    - список юнитов объекта (включая имена арендаторов)
POST   /api/units                   - создать юнит
GET    /api/units/:id               - получить юнит (включая информацию об арендаторе)
PUT    /api/units/:id               - обновить юнит
DELETE /api/units/:id               - удалить юнит
GET    /api/units/:id/tenant        - получить информацию об арендаторе юнита

GET    /api/units/:id/profitability - расчет доходности юнита (план/факт)
GET    /api/properties/:id/stats    - статистика по объекту (план/факт)
GET    /api/dashboard               - данные для дашборда (план/факт)

GET    /api/mandatory-payments                    - список плановых обязательных платежей
POST   /api/mandatory-payments                    - создать плановый обязательный платеж
GET    /api/mandatory-payments/:id                - получить плановый платеж
PUT    /api/mandatory-payments/:id                - обновить плановый платеж
DELETE /api/mandatory-payments/:id                - удалить плановый платеж

GET    /api/actual-mandatory-payments             - список фактических обязательных платежей
GET    /api/actual-mandatory-payments/month/:month/year/:year - платежи за месяц
POST   /api/actual-mandatory-payments              - создать/обновить фактический платеж
PUT    /api/actual-mandatory-payments/:id          - обновить фактический платеж
POST   /api/actual-mandatory-payments/:id/mark-paid - отметить как оплаченный

GET    /api/tenant-payments                        - список платежей от арендаторов
GET    /api/tenant-payments/month/:month/year/:year - платежи за месяц
POST   /api/tenant-payments                        - создать/обновить платеж от арендатора
PUT    /api/tenant-payments/:id                    - обновить платеж от арендатора
POST   /api/tenant-payments/:id/mark-paid          - отметить как полученный
POST   /api/tenant-payments/generate-monthly       - сгенерировать плановые платежи на месяц

GET    /api/transactions                           - список транзакций (с фильтром план/факт)
GET    /api/transactions/planned                   - плановые транзакции
GET    /api/transactions/actual                    - фактические транзакции
POST   /api/transactions                           - создать транзакцию
```

### 9.2 Пример структуры данных (JSON)

**Объект:**
```json
{
  "id": 1,
  "name": "Торговый центр 'Солнечный'",
  "address": "г. Москва, ул. Ленина, д. 10",
  "total_area": 5000,
  "units_count": 25,
  "occupied_units": 20,
  "occupancy_rate": 80,
  "monthly_revenue": 2500000
}
```

**Юнит:**
```json
{
  "id": 1,
  "property_id": 1,
  "unit_number": "101",
  "area": 50,
  "price_per_sqm": 1000,
  "planned_monthly_rent": 50000,
  "actual_monthly_rent": 48000,
  "planned_mandatory_payments": 5000,
  "actual_mandatory_payments": 5200,
  "planned_net_profit": 45000,
  "actual_net_profit": 42800,
  "planned_profitability": 90,
  "actual_profitability": 89.17,
  "status": "rented",
  "current_tenant_id": 5,
  "current_tenant_name": "ООО 'Торговый дом'",
  "current_lease_id": 12
}
```

**Юнит (свободный):**
```json
{
  "id": 2,
  "property_id": 1,
  "unit_number": "102",
  "area": 75,
  "price_per_sqm": 1200,
  "planned_monthly_rent": 90000,
  "actual_monthly_rent": null,
  "planned_mandatory_payments": 8000,
  "actual_mandatory_payments": null,
  "planned_net_profit": null,
  "actual_net_profit": null,
  "planned_profitability": null,
  "actual_profitability": null,
  "status": "vacant",
  "current_tenant_id": null,
  "current_tenant_name": null,
  "current_lease_id": null
}
```

**Плановый обязательный платеж:**
```json
{
  "id": 1,
  "unit_id": 1,
  "property_id": null,
  "payment_type": "коммунальные",
  "amount": 5000,
  "frequency": "ежемесячно",
  "start_date": "2026-01-01",
  "end_date": null,
  "is_cost": true
}
```

**Фактический обязательный платеж:**
```json
{
  "id": 1,
  "mandatory_payment_id": 1,
  "unit_id": 1,
  "property_id": null,
  "payment_type": "коммунальные",
  "planned_amount": 5000,
  "actual_amount": 5200,
  "payment_date": "2026-02-15",
  "month": 2,
  "year": 2026,
  "status": "оплачено",
  "is_paid": true
}
```

**Платеж от арендатора (план):**
```json
{
  "id": 1,
  "lease_id": 12,
  "unit_id": 1,
  "tenant_id": 5,
  "planned_amount": 50000,
  "actual_amount": null,
  "payment_date": null,
  "month": 2,
  "year": 2026,
  "status": "ожидается",
  "is_paid": false
}
```

**Платеж от арендатора (факт):**
```json
{
  "id": 1,
  "lease_id": 12,
  "unit_id": 1,
  "tenant_id": 5,
  "planned_amount": 50000,
  "actual_amount": 48000,
  "payment_date": "2026-02-10",
  "month": 2,
  "year": 2026,
  "status": "получено",
  "is_paid": true,
  "payment_method": "безналичный",
  "description": "Частичная оплата"
}
```

---

## 10. Автоматизация и бизнес-логика

### 10.1 Автоматическая генерация платежей

**Ежемесячная генерация (1 число каждого месяца):**

1. **Генерация плановых платежей от арендаторов:**
   - Для каждого активного договора аренды создается запись `TenantPayment`
   - `planned_amount` = месячная арендная плата из договора
   - `status` = "ожидается"
   - `is_paid` = false
   - `month` = текущий месяц
   - `year` = текущий год

2. **Генерация фактических обязательных платежей:**
   - Для каждого планового обязательного платежа (`MandatoryPayment`) с `frequency = "ежемесячно"` создается запись `ActualMandatoryPayment`
   - `planned_amount` = сумма из `MandatoryPayment`
   - `status` = "планируется"
   - `is_paid` = false
   - `month` = текущий месяц
   - `year` = текущий год

**Период внесения фактических данных:**
- Пользователь может вносить фактические платежи с 1 по 30 число каждого месяца
- После внесения фактических данных система автоматически пересчитывает показатели доходности

**Обновление статусов:**
- После 30 числа неоплаченные платежи автоматически получают статус "просрочено"
- Система отправляет уведомления о просроченных платежах

### 10.2 Учет себестоимости

**Обязательные платежи как себестоимость:**
- Плановые обязательные платежи с `is_cost = true` учитываются как себестоимость юнита/объекта
- Фактические обязательные платежи с `is_cost = true` формируют фактическую себестоимость
- Себестоимость влияет на расчет чистой прибыли и рентабельности

---

## 11. Риски и митигация

### Риски:
1. **Сложность расчетов** - митигация: тщательное тестирование формул, разделение плановых и фактических расчетов
2. **Производительность при большом объеме данных** - митигация: индексация БД, кэширование, оптимизация запросов
3. **Удобство интерфейса** - митигация: пользовательское тестирование, итеративная разработка, упрощенный процесс внесения фактических данных
4. **Безопасность данных** - митигация: валидация данных, защита от SQL-инъекций
5. **Синхронизация плановых и фактических данных** - митигация: автоматическая генерация, четкие правила обновления статусов
6. **Пропуск внесения фактических данных** - митигация: уведомления, напоминания, визуальные индикаторы

---

## 12. Следующие шаги

1. **Выбор технологического стека** - определиться с конкретными технологиями
2. **Создание прототипа** - начать с MVP версии
3. **Настройка окружения разработки** - установка необходимых инструментов
4. **Создание базы данных** - проектирование и создание схемы БД
5. **Разработка Backend API** - создание серверной части
6. **Разработка Frontend** - создание пользовательского интерфейса
7. **Тестирование** - проверка функциональности
8. **Деплой** - развертывание системы

---

## 13. Дополнительные рекомендации

- Начать с простой версии и постепенно добавлять функции
- Регулярно получать обратную связь от пользователя
- Использовать готовые библиотеки для графиков и UI компонентов
- Документировать код и API
- Версионировать изменения в базе данных (миграции)
- Реализовать резервное копирование данных

---

**Дата создания плана:** 13 февраля 2026
**Версия:** 1.0
